<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enqvy Discord Presence</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Arial', sans-serif;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, var(--accent-1,#ff006e), var(--accent-2,#00f5ff), var(--accent-3,#ffd60a));
      transition: background 0.5s ease;
      overflow: hidden;
    }

    /* Floating animated glow behind the window */
    .glow-orb {
      position: absolute;
      width: 350px;
      height: 350px;
      border-radius: 50%;
      filter: blur(85px);
      opacity: 0.5;
      pointer-events: none;
      animation: floatGlow 12s infinite ease-in-out;
    }

    @keyframes floatGlow {
      0%   { transform: translate(-40px, -30px) scale(1); }
      50%  { transform: translate(40px, 50px) scale(1.25); }
      100% { transform: translate(-40px, -30px) scale(1); }
    }

    /* MAIN GLASS WINDOW */
    #windowWrapper {
      padding: 35px 45px;
      border-radius: 22px;
      background: rgba(255, 255, 255, 0.12);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border: 1px solid rgba(255, 255, 255, 0.25);
      box-shadow: 0 10px 40px rgba(0,0,0,0.35);
      z-index: 2;

      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;

      opacity: 0;
      animation: fadeIn 1.1s ease forwards;
    }

    /* Subtle breathing animation for the glass */
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.94); }
      to { opacity: 1; transform: scale(1); }
    }

    @keyframes glassPulse {
      0% { background: rgba(255, 255, 255, 0.12); }
      50% { background: rgba(255, 255, 255, 0.18); }
      100% { background: rgba(255, 255, 255, 0.12); }
    }

    #windowWrapper {
      animation: fadeIn 1.1s ease forwards, glassPulse 8s infinite ease-in-out;
    }

    /* PROFILE STYLE */
    #profile { text-align: center; color: #fff; z-index: 3; }

    #avatar {
      width: 128px;
      height: 128px;
      border-radius: 50%;
      border: 3px solid #fff;
      margin-bottom: 10px;
      box-shadow: 0 0 15px rgba(255,255,255,0.4);
    }

    #statusIndicator {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: inline-block;
      margin-left: 8px;
      vertical-align: middle;
      border: 2px solid #fff;
      box-shadow: 0 0 10px rgba(255,255,255,0.6);
    }

    #customStatus {
      margin-top: 5px;
      font-style: italic;
      opacity: 0.85;
    }

  </style>
</head>
<body>

  <!-- Animated glowing background elements -->
  <div class="glow-orb" id="glow1"></div>
  <div class="glow-orb" id="glow2" style="animation-delay: -4s;"></div>
  <div class="glow-orb" id="glow3" style="animation-delay: -7s;"></div>

  <!-- Glass Window -->
  <div id="windowWrapper">
    <div id="profile">
      <img id="avatar" src="" alt="Avatar">
      <h2 id="username">Loading...</h2>
      <span id="statusIndicator"></span>
      <div id="customStatus"></div>
    </div>
  </div>

  <script>
    const CONFIG = {
      discordUserId: "1437013692440121414",
      backgroundImage: "https://files.catbox.moe/265m5g.avif"
    };

    function extractColors(imageUrl) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = "Anonymous";
        img.src = imageUrl;
        img.onload = () => {
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");

          canvas.width = 50;
          canvas.height = 50;
          ctx.drawImage(img, 0, 0, 50, 50);

          const data = ctx.getImageData(0, 0, 50, 50).data;

          let r=0,g=0,b=0,count=0;
          for(let i=0;i<data.length;i+=4){
            r+=data[i];
            g+=data[i+1];
            b+=data[i+2];
            count++;
          }

          r = Math.floor(r/count);
          g = Math.floor(g/count);
          b = Math.floor(b/count);

          resolve({
            color1:`rgb(${r},${g},${b})`,
            color2:`rgb(${b},${r},${g})`,
            color3:`rgb(${g},${b},${r})`
          });
        };
        img.onerror = () => reject("Failed to load image");
      });
    }

    async function updateTheme(imageUrl) {
      try {
        const cols = await extractColors(imageUrl);
        document.documentElement.style.setProperty("--accent-1", cols.color1);
        document.documentElement.style.setProperty("--accent-2", cols.color2);
        document.documentElement.style.setProperty("--accent-3", cols.color3);

        // Make glowing orbs match theme
        document.getElementById("glow1").style.background = cols.color1;
        document.getElementById("glow2").style.background = cols.color2;
        document.getElementById("glow3").style.background = cols.color3;

      } catch(e) {
        console.error(e);
      }
    }

    // Theme from background
    updateTheme(CONFIG.backgroundImage);

    function connectLanyard(){
      const ws = new WebSocket("wss://api.lanyard.rest/socket");
      let heartbeat;

      ws.onmessage = async event => {
        const payload = JSON.parse(event.data);

        switch (payload.op) {
          case 1:
            heartbeat = setInterval(() => ws.send(JSON.stringify({ op: 3 })), payload.d.heartbeat_interval);
            ws.send(JSON.stringify({ op: 2, d: { subscribe_to_id: CONFIG.discordUserId }}));
            break;

          case 0:
            if (payload.t === "INIT_STATE" || payload.t === "PRESENCE_UPDATE") {
              const data = payload.d;
              const u = data.discord_user;
              const status = data.discord_status;
              const activities = data.activities;

              document.getElementById("username").textContent = u.username;
              document.getElementById("avatar").src =
                `https://cdn.discordapp.com/avatars/${u.id}/${u.avatar}.png?size=256`;

              const statusColours = {
                online:"#43b581",
                idle:"#faa61a",
                dnd:"#f04747",
                offline:"#747f8d"
              };

              document.getElementById("statusIndicator").style.background =
                statusColours[status] ?? statusColours.offline;

              const custom = activities.find(a => a.type === 4);
              document.getElementById("customStatus").textContent = custom?.state || "";

              // Theme updates based on avatar
              await updateTheme(`https://cdn.discordapp.com/avatars/${u.id}/${u.avatar}.png?size=256`);
            }
            break;
        }
      };

      ws.onclose = () => {
        clearInterval(heartbeat);
        setTimeout(connectLanyard, 5000);
      };
    }

    connectLanyard();
  </script>
</body>
</html>
